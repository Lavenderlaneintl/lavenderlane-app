import React, { useState, useRef } from "react";
import { useRouter } from "expo-router";
import { StyleSheet } from "react-native";
import Onboarding from "react-native-onboarding-swiper";
import { Image } from "expo-image";

import AppButton from "../components/AppButton";
import { setLocalData } from "@/utils/configs/localStorage";
import { ThemedText } from "@/components/ThemedText";
import Size from "@/utils/hooks/useResponsiveSize";
import { ThemedView } from "@/components/ThemedView";

const OnboardingScreen = (): JSX.Element => {
  const [currentIndex, setCurrentIndex] = useState(0);
  const router = useRouter();

  const onboardingRef = useRef<Onboarding>(null);

  const handlePageCallBack = (pageIndex: number): void => {
    setCurrentIndex(pageIndex);
  };

  const handleGetStarted = (): void => {
    // setLocalData("isOnboard", "true", () =>
    // router.replace(routes.LOGIN_SCREEN)
    // );
  };

  const pages = [
    {
      backgroundColor: "transparent",
      image: (
        <>
          <Image
            style={{ width: Size.calcWidth(300), height: Size.calcHeight(300) }}
            source={require("../assets/images/onboarding-1.png")}
          />
          <ThemedText style={styles.titleStyles}>
            Seamless Bill Payment
          </ThemedText>
          <ThemedText style={styles.subtitleStyles}>
            Effortlessly manage and pay your bills with just a few taps.
            Simplify your life and never miss a payment
          </ThemedText>
        </>
      ),
      title: "",
      subtitle: "",
    },
    {
      backgroundColor: "transparent",
      image: (
        <>
          <Image
            style={{ width: Size.calcWidth(300), height: Size.calcHeight(300) }}
            source={require("../assets/images/onboarding-2.png")}
          />
          <ThemedText style={styles.titleStyles}>
            Trusted and Risk Free Transactions
          </ThemedText>
          <ThemedText style={styles.subtitleStyles}>
            Experience hassle-free and instant transfers wherever you go and
            send money to friends and family with ease
          </ThemedText>
        </>
      ),
      title: "",
      subtitle: "",
    },
    {
      backgroundColor: "transparent",
      image: (
        <>
          <Image
            style={{ width: Size.calcWidth(300), height: Size.calcHeight(300) }}
            source={require("../assets/images/onboarding-3.png")}
          />
          <ThemedText style={styles.titleStyles}>Welcome to PayTap</ThemedText>
          <ThemedText style={styles.subtitleStyles}>
            Experience a world of convenience, security, and innovation as you
            manage your bills with ease
          </ThemedText>
        </>
      ),
      title: "",
      subtitle: "",
    },
  ];

  return (
    <ThemedView style={styles.container}>
      {/* @ts-ignore */}
      <Onboarding
        showPagination={false}
        pageIndexCallback={handlePageCallBack}
        ref={onboardingRef}
        pages={pages}
      />
      <ThemedView style={styles.dotContainer}>
        {pages.map((_, index) => (
          <ThemedView
            key={index}
            style={[styles.dot, index === currentIndex && styles.dotActive]}
          />
        ))}
      </ThemedView>
      <AppButton
        onPress={handleGetStarted}
        style={styles.button}
        title="Get Started"
      />
    </ThemedView>
  );
};

const styles = StyleSheet.create({
  container: {
    paddingHorizontal: 0,
    position: "relative",
    flex: 1,
  },

  titleStyles: {
    width: Size.calcWidth(300),
    fontSize: Size.calcWidth(26),
    color: "black",
    textAlign: "center",
    marginTop: Size.calcHeight(30),
    marginBottom: Size.calcHeight(11),
  },

  subtitleStyles: {
    alignSelf: "center",
    width: Size.calcWidth(250),
    textAlign: "center",
  },

  dot: {
    height: Size.calcHeight(5),
    width: Size.calcWidth(10),
    backgroundColor: "#e3e3e3",
    marginHorizontal: Size.calcWidth(2.5),
    borderRadius: Size.calcAverage(20),
  },

  dotActive: {
    width: Size.calcWidth(25),
    backgroundColor: "blue",
  },

  dotContainer: {
    position: "absolute",
    width: "100%",
    bottom: Size.calcHeight(190),
    flexDirection: "row",
    justifyContent: "center",
    padding: Size.calcAverage(10),
  },

  button: {
    marginBottom: Size.calcHeight(64),
    width: "80%",
    alignSelf: "center",
  },
});

export default OnboardingScreen;
